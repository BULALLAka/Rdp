name: LocalXpose RDP Tunnel

on:
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Download LocalXpose
      run: |
        wget https://api.localxpose.io/api/downloads/loclx-linux-amd64.zip -O loclx.zip
        unzip loclx.zip
        chmod +x loclx

    - name: Set LocalXpose config
      run: |
        mkdir -p ~/.localxpose
        echo "auth_token: ${{ secrets.LOCALXPOSE_TOKEN }}" > ~/.localxpose/config.yaml

    - name: Check Login
      run: ./loclx account status || true

    - name: Install XRDP + Desktop
      run: |
        sudo apt update
        sudo apt install -y xrdp xfce4
        sudo sed -i 's/console/anybody/g' /etc/X11/Xwrapper.config
        sudo systemctl enable xrdp
        sudo systemctl restart xrdp

    - name: Start RDP Tunnel
      run: |
        echo "ðŸ”¥ TÃ¼nel aÃ§Ä±lÄ±yor..."
        ./loclx tunnel tcp --to 3389
